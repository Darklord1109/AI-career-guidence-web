<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareerPathAI - Test Center</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="test-styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <!-- Header & Navigation -->
    <header class="header">
        <div class="nav-container">
            <a href="index.html" class="logo">CareerPathAI</a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="explore.html">Explore</a></li>
                <li><a href="test.html" class="active">Test</a></li>
                <li><a href="pathways.html">Pathways</a></li>
                <li><a href="skills-gap.html">Skills Gap</a></li>
                <li><a href="resources.html">Resources</a></li>
                <li class="auth-buttons">
                    <button id="login-button" class="nav-auth-btn">Login</button>
                    <button id="signup-button" class="nav-auth-btn">Sign Up</button>
                    <a href="user-profile.html" class="user-icon">
                    <i class="fas fa-user-circle"></i></a>
                </li>
            </ul>
        </div>
    </header>
    
    <!-- Page Header -->
    <div class="page-header">
        <h1>Assessment Center</h1>
        <p>Discover your strengths, skills, and career compatibility with our comprehensive assessment tools</p>
    </div>
    
    <!-- Auth Modal -->
    <div class="auth-modal" id="auth-modal">
        <div class="auth-container">
            <div class="auth-header">
                <div class="auth-tabs">
                    <button id="login-tab" class="auth-tab active" data-target="#login-form">Login</button>
                    <button id="signup-tab" class="auth-tab" data-target="#signup-form">Sign Up</button>
                </div>
                <div style="text-align: center; padding: 10px; background-color: #e8f4ff; margin: 10px 0; border-radius: 5px;">
                    <p style="margin: 0; color: #0066cc;"><strong>Note:</strong> Login is optional. You can take tests without an account.</p>
                </div>

                <!-- Personality Test Configuration -->
                <div class="test-config" id="personality-config">
                    <h3>Configure Your Personality Assessment</h3>
                    <div class="config-grid">
                        <div class="config-group">
                            <label for="personality-type">Assessment Type</label>
                            <select id="personality-type">
                                <option value="mbti" selected>MBTI-Inspired</option>
                                <option value="big5">Big Five Traits</option>
                                <option value="holland">Holland Code</option>
                            </select>
                        </div>
                        <div class="config-group">
                            <label for="personality-duration">Test Duration</label>
                            <select id="personality-duration">
                                <option value="10">10 minutes (Quick)</option>
                                <option value="20" selected>20 minutes (Standard)</option>
                                <option value="30">30 minutes (Comprehensive)</option>
                            </select>
                        </div>
                        <div class="config-group">
                            <label for="personality-detail">Detail Level</label>
                            <select id="personality-detail">
                                <option value="basic">Basic (Overview)</option>
                                <option value="standard" selected>Standard (Detailed)</option>
                                <option value="comprehensive">Comprehensive (In-depth)</option>
                            </select>
                        </div>
                    </div>
                    <div class="text-center mt-2">
                        <button class="btn btn-primary" id="start-personality">Start Assessment</button>
                    </div>
                </div>

                <!-- Skills Test Configuration -->
                <div class="test-config" id="skills-config">
                    <h3>Configure Your Skills Assessment</h3>
                    <div class="config-grid">
                        <div class="config-group">
                            <label for="skills-category">Skill Categories</label>
                            <select id="skills-category">
                                <option value="all" selected>All Skills</option>
                                <option value="technical">Technical Skills</option>
                                <option value="soft">Soft Skills</option>
                                <option value="transferable">Transferable Skills</option>
                            </select>
                        </div>
                        <div class="config-group">
                            <label for="skills-duration">Test Duration</label>
                            <select id="skills-duration">
                                <option value="15">15 minutes (Quick)</option>
                                <option value="25" selected>25 minutes (Standard)</option>
                                <option value="40">40 minutes (Comprehensive)</option>
                            </select>
                        </div>
                        <div class="config-group">
                            <label for="skills-industry">Industry Focus</label>
                            <select id="skills-industry">
                                <option value="general" selected>General</option>
                                <option value="tech">Technology</option>
                                <option value="business">Business</option>
                                <option value="healthcare">Healthcare</option>
                                <option value="creative">Creative</option>
                            </select>
                        </div>
                    </div>
                    <div class="text-center mt-2">
                        <button class="btn btn-primary" id="start-skills">Start Assessment</button>
                    </div>
                </div>
                <button class="close-modal" id="close-auth-modal">&times;</button>
            </div>
            <div class="auth-content">
                <!-- Login Form -->
                <form id="login-form" class="auth-form active">
                    <h3>Welcome Back</h3>
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" name="password" required>
                    </div>
                    <div class="remember-me">
                        <label>
                            <input type="checkbox" name="remember"> Remember me
                        </label>
                        <a href="#" class="forgot-password">Forgot Password?</a>
                    </div>
                    <button type="submit" class="auth-button">Login</button>
                </form>
                
                <!-- Sign Up Form -->
                <form id="signup-form" class="auth-form">
                    <h3>Create Account</h3>
                    <div class="form-group">
                        <label for="signup-name">Full Name</label>
                        <input type="text" id="signup-name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-email">Email</label>
                        <input type="email" id="signup-email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-password">Password</label>
                        <input type="password" id="signup-password" name="password" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-confirm">Confirm Password</label>
                        <input type="password" id="signup-confirm" name="confirm" required>
                    </div>
                    <button type="submit" class="auth-button">Sign Up</button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Error Message Container -->
    <div class="error-container" id="errorContainer">
        <div class="error-message">
            <i class="fas fa-exclamation-circle"></i>
            <p id="errorMessage">Error message goes here</p>
            <button class="close-error" onclick="document.getElementById('errorContainer').style.display = 'none'">&times;</button>
        </div>
    </div>
    
    <div class="test-container">

        <!-- Test Selection Section -->
        <div class="test-selection" id="testSelection">
            <div class="test-selection-header">
                <h2>Choose Your Assessment</h2>
                <button class="btn btn-secondary" id="viewHistoryBtn">
                    <i class="fas fa-history"></i>
                    View Test History
                </button>
            </div>
            <div class="test-cards" style="display: flex; justify-content: space-between; gap: 20px;">
                <div class="test-card" data-test-type="aptitude">
                    <div class="test-card-header">
                        <i class="fas fa-brain"></i>
                        <h3>Cognitive Aptitude <br> Test</h3>
                    </div>
                    <div class="test-card-body">
                        <p>Assess your logical reasoning, pattern recognition, and problem-solving abilities.</p>
                        <ul class="test-features">
                            <li><i class="fas fa-check"></i> Numerical Reasoning</li>
                            <li><i class="fas fa-check"></i> Logical Thinking</li>
                            <li><i class="fas fa-check"></i> Verbal Comprehension</li>
                            <li><i class="fas fa-check"></i> Spatial Awareness</li>
                        </ul>
                    </div>
                    <button class="btn btn-primary select-test-btn">Select</button>
                </div>
                
                <div class="test-card" data-test-type="technical">
                    <div class="test-card-header">
                        <i class="fas fa-code"></i>
                        <h3>Technical Skills Assessment</h3>
                    </div>
                    <div class="test-card-body">
                        <p>Evaluate your technical knowledge, coding abilities, and problem-solving skills.</p>
                        <ul class="test-features">
                            <li><i class="fas fa-check"></i> Programming Logic</li>
                            <li><i class="fas fa-check"></i> Algorithm Knowledge</li>
                            <li><i class="fas fa-check"></i> Data Structures</li>
                            <li><i class="fas fa-check"></i> System Design</li>
                        </ul>
                    </div>
                    <button class="btn btn-primary select-test-btn">Select</button>
                </div>
                
                <div class="test-card" data-test-type="softSkills">
                    <div class="test-card-header">
                        <i class="fas fa-users"></i>
                        <h3>Professional Skills Evaluation</h3>
                    </div>
                    <div class="test-card-body">
                        <p>Measure your communication, leadership, and interpersonal effectiveness.</p>
                        <ul class="test-features">
                            <li><i class="fas fa-check"></i> Communication Skills</li>
                            <li><i class="fas fa-check"></i> Leadership Potential</li>
                            <li><i class="fas fa-check"></i> Teamwork Abilities</li>
                            <li><i class="fas fa-check"></i> Problem-Solving</li>
                        </ul>
                    </div>
                    <button class="btn btn-primary select-test-btn">Select</button>
                </div>
            </div>
        </div>
  

                <!-- Aptitude Test Configuration -->
                <div class="test-config" id="aptitude-config">
                    <h3>Configure Your Aptitude Assessment</h3>
                    <div class="config-grid">
                        <div class="config-group">
                            <label for="aptitude-difficulty">Difficulty Level</label>
                            <select id="aptitude-difficulty">
                                <option value="beginner">Beginner</option>
                                <option value="intermediate" selected>Intermediate</option>
                                <option value="advanced">Advanced</option>
                            </select>
                        </div>
                        <div class="config-group">
                            <label for="aptitude-duration">Test Duration</label>
                            <select id="aptitude-duration">
                                <option value="15">15 minutes (Quick)</option>
                                <option value="30" selected>30 minutes (Standard)</option>
                                <option value="45">45 minutes (Comprehensive)</option>
                            </select>
                        </div>
                        <div class="config-group">
                            <label for="aptitude-focus">Focus Areas</label>
                            <select id="aptitude-focus">
                                <option value="all" selected>All Areas</option>
                                <option value="logical">Logical Reasoning</option>
                                <option value="numerical">Numerical Aptitude</option>
                                <option value="verbal">Verbal Comprehension</option>
                                <option value="spatial">Spatial Reasoning</option>
                            </select>
                        
                    </div>
                    <div class="text-center mt-2">
                        <button class="btn btn-primary" id="start-aptitude">Start Assessment</button>
                    </div>
                </div>
                
                <!-- Benefit cards removed as requested -->
            </div>
        </div>

        <!-- Test Configuration Section -->
        <div class="test-config" id="aptitude-config">
            <h3>Configure Your Aptitude Assessment</h3>
            <div class="config-grid">
                <div class="config-group">
                    <label for="aptitude-difficulty">Difficulty Level</label>
                    <select id="aptitude-difficulty" class="form-control">
                        <option value="beginner">Beginner</option>
                        <option value="intermediate" selected>Intermediate</option>
                        <option value="advanced">Advanced</option>
                    </select>
                </div>
                
                <div class="config-group">
                    <label for="aptitude-duration">Test Duration</label>
                    <select id="aptitude-duration" class="form-control">
                        <option value="15">15 minutes</option>
                        <option value="30" selected>30 minutes</option>
                        <option value="45">45 minutes</option>
                        <option value="60">60 minutes</option>
                    </select>
                </div>
                
                <div class="config-group">
                    <label for="aptitude-focus">Focus Areas</label>
                    <select id="aptitude-focus" class="form-control" multiple>
                        <option value="logical" selected>Logical Reasoning</option>
                        <option value="verbal" selected>Verbal Ability</option>
                        <option value="numerical" selected>Numerical Ability</option>
                        <option value="spatial">Spatial Reasoning</option>
                        <option value="abstract">Abstract Reasoning</option>
                    </select>
                </div>
            </div>
            
            <div class="config-actions">
                <button class="config-button secondary">Back to Tests</button>
                <button class="config-button primary">Start Assessment</button>
            </div>
        </div>

        <!-- Personality Test Configuration -->
        <div class="test-config" id="personality-config">
            <h3>Configure Your Interest & Personality Assessment</h3>
            <div class="config-grid">
                <div class="config-group">
                    <label for="personality-type">Assessment Type</label>
                    <select id="personality-type" class="form-control">
                        <option value="mbti" selected>Myers-Briggs Type Indicator</option>
                        <option value="holland">Holland Code (RIASEC)</option>
                        <option value="big5">Big Five Personality Traits</option>
                    </select>
                </div>
                
                <div class="config-group">
                    <label for="personality-duration">Test Duration</label>
                    <select id="personality-duration" class="form-control">
                        <option value="10">10 minutes</option>
                        <option value="20" selected>20 minutes</option>
                        <option value="30">30 minutes</option>
                    </select>
                </div>
                
                <div class="config-group">
                    <label for="personality-detail">Detail Level</label>
                    <select id="personality-detail" class="form-control">
                        <option value="basic">Basic</option>
                        <option value="standard" selected>Standard</option>
                        <option value="comprehensive">Comprehensive</option>
                    </select>
                </div>
            </div>
            
            <div class="config-actions">
                <button class="config-button secondary">Back to Tests</button>
                <button class="config-button primary">Start Assessment</button>
            </div>
        </div>

        <!-- Skills Test Configuration -->
        <div class="test-config" id="skills-config">
            <h3>Configure Your Skills Assessment</h3>
            <div class="config-grid">
                <div class="config-group">
                    <label for="skills-category">Skill Categories</label>
                    <select id="skills-category" class="form-control" multiple>
                        <option value="technical" selected>Technical Skills</option>
                        <option value="soft" selected>Soft Skills</option>
                        <option value="language">Language Skills</option>
                        <option value="management">Management Skills</option>
                    </select>
                </div>
                
                <div class="config-group">
                    <label for="skills-industry">Industry Focus</label>
                    <select id="skills-industry" class="form-control">
                        <option value="general" selected>General</option>
                        <option value="tech">Technology</option>
                        <option value="business">Business</option>
                        <option value="healthcare">Healthcare</option>
                        <option value="creative">Creative</option>
                    </select>
                </div>
                
                <div class="config-group">
                    <label for="skills-duration">Test Duration</label>
                    <select id="skills-duration" class="form-control">
                        <option value="15">15 minutes</option>
                        <option value="25" selected>25 minutes</option>
                        <option value="40">40 minutes</option>
                    </select>
                </div>
            </div>
            
            <div class="config-actions">
                <button class="config-button secondary">Back to Tests</button>
                <button class="config-button primary">Start Assessment</button>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div class="loading" id="test-loading">
            <div class="spinner"></div>
            <p>Preparing your assessment...</p>
        </div>
            <!-- Main Content -->
    <main class="test-container">

        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p id="loading-text">AI is analyzing your profile...</p>
        </div>
        
        <!-- Test Configuration -->
        <div class="test-config" id="testConfig">
            <h3>Configure Your AI Assessment</h3>
            <div class="config-grid">
                <div class="config-group">
                    <label for="testLevel">Difficulty Level</label>
                    <select id="testLevel">
                        <option value="beginner">Beginner</option>
                        <option value="intermediate" selected>Intermediate</option>
                        <option value="advanced">Advanced</option>
                    </select>
                </div>
                <div class="config-group">
                    <label for="questionCount">Number of Questions</label>
                    <select id="questionCount">
                        <option value="10">10 Questions</option>
                        <option value="20" selected>20 Questions</option>
                        <option value="30">30 Questions</option>
                        <option value="50">50 Questions</option>
                    </select>
                </div>
                <div class="config-group">
                    <label for="timeLimit">Time Limit (minutes)</label>
                    <select id="timeLimit">
                        <option value="15">15 minutes</option>
                        <option value="30" selected>30 minutes</option>
                        <option value="45">45 minutes</option>
                        <option value="60">60 minutes</option>
                    </select>
                </div>
                <div class="config-group" id="domainGroup" style="display: none;">
                    <label for="testDomain">Domain</label>
                    <select id="testDomain">
                        <option value="web_development">Web Development</option>
                        <option value="mobile_development">Mobile Development</option>
                        <option value="data_science">Data Science</option>
                        <option value="cybersecurity">Cybersecurity</option>
                        <option value="cloud_computing">Cloud Computing</option>
                        <option value="ai_ml">AI & Machine Learning</option>
                    </select>
                </div>
            </div>
            <div class="text-center">
                <button class="btn btn-primary" id="startTestBtn">
                    <i class="fas fa-play"></i>
                    Start AI Assessment
                </button>
                <button class="btn btn-secondary" id="backToSelectionBtn">
                    <i class="fas fa-arrow-left"></i>
                    Back to Tests
                </button>
            </div>
        </div>

        <!-- Test Interface -->
        <div class="test-interface" id="testInterface">
            <div class="test-header-bar">
                <div style="display: flex; align-items: center; gap: 2rem;">
                    <span id="testTypeDisplay">Aptitude Test</span>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <span id="questionProgress">Question 1 of 20</span>
                </div>
                <div class="timer" id="timer">30:00</div>
            </div>

            <div class="question-container">
                <div class="question-text" id="questionText">Loading AI-generated question...</div>
                <div class="options-container" id="optionsContainer">
                    <!-- Options will be populated here -->
                </div>
            </div>

            <div class="test-controls">
                <button class="btn btn-secondary" id="previousBtn" disabled>
                    <i class="fas fa-arrow-left"></i>
                    Previous
                </button>
                <button class="btn btn-primary" id="nextBtn">
                    Next
                    <i class="fas fa-arrow-right"></i>
                </button>
                <button class="btn btn-primary" id="submitTestBtn" style="display: none;">
                    <i class="fas fa-check"></i>
                    Submit Test
                </button>
            </div>
        </div>

        <!-- Test History Container -->
        <div class="history-container" id="testHistoryContainer">
            <h2>Your Test History</h2>
            <div class="history-list" id="testHistoryList">
                <!-- Test history items will be added here dynamically -->
            </div>
            <div class="history-actions">
                <button class="btn btn-secondary" id="backToTestsBtn">
                    <i class="fas fa-arrow-left"></i>
                    Back to Tests
                </button>
            </div>
        </div>
        
        <!-- Results Container -->
        <div class="results-container" id="resultsContainer">
            <div class="results-header">
                <h2>Your AI Assessment Results</h2>
                <div class="score-display" id="scoreDisplay">85%</div>
                <p id="testSummary">Excellent performance! Your AI analysis reveals strong potential.</p>
            </div>

            <div class="results-content">
                <div class="alert alert-success" id="resultsAlert">
                    <strong>Assessment Complete!</strong> Your AI-powered analysis is ready.
                </div>

                <div class="results-grid">
                    <div class="result-card">
                        <h3><i class="fas fa-star"></i> Key Strengths</h3>
                        <div id="strengthsList">
                            <!-- Strengths will be populated here -->
                        </div>
                    </div>

                    <div class="result-card">
                        <h3><i class="fas fa-exclamation-triangle"></i> Areas for Growth</h3>
                        <div id="weaknessesList">
                            <!-- Weaknesses will be populated here -->
                        </div>
                    </div>

                    <div class="result-card">
                        <h3><i class="fas fa-lightbulb"></i> AI Recommendations</h3>
                        <div id="recommendationsList">
                            <!-- Recommendations will be populated here -->
                        </div>
                    </div>

                    <div class="result-card">
                        <h3><i class="fas fa-briefcase"></i> Career Paths</h3>
                        <div id="careerPathsList">
                            <!-- Career paths will be populated here -->
                        </div>
                    </div>
                </div>

                <div class="text-center">
                    <button class="btn btn-primary" id="retakeTestBtn">
                        <i class="fas fa-redo"></i>
                        Retake Assessment
                    </button>
                    <button class="btn btn-secondary" id="backToHomeBtn">
                        <i class="fas fa-home"></i>
                        Back to Home
                    </button>
                </div>
            </div>
        </div>
    </main>


        <!-- Test Instructions -->
        <div class="test-instructions">
            <h2>Test Instructions</h2>
            <div class="instruction-card">
                <div class="instruction-icon">
                    <i class="fas fa-info-circle"></i>
                </div>
                <div class="instruction-content">
                    <h3>Before You Begin</h3>
                    <ul class="instruction-list">
                        <li>Find a quiet place where you can focus without interruptions</li>
                        <li>Set aside the full time required to complete the assessment</li>
                        <li>Answer honestly - there are no right or wrong answers</li>
                        <li>Don't overthink your responses - go with your first instinct</li>
                        <li>Complete the test in one sitting for the most accurate results</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- FAQ Section -->
        <div class="faq-section">
            <h2>Frequently Asked Questions</h2>
            <div class="faq-grid">
                <div class="faq-item">
                    <h3>How long do the tests take to complete?</h3>
                    <p>Test duration varies based on the type and configuration. Most assessments take between 15-45 minutes to complete.</p>
                </div>
                
                <div class="faq-item">
                    <h3>How accurate are the results?</h3>
                    <p>Our assessments are based on established psychological frameworks and data science, providing reliable insights when answered honestly.</p>
                </div>
                
                <div class="faq-item">
                    <h3>Can I retake the tests?</h3>
                    <p>Yes, you can retake any assessment after 30 days to see how your skills and preferences have evolved.</p>
                </div>
                
                <div class="faq-item">
                    <h3>How are my results used?</h3>
                    <p>Your results are used to generate personalized career recommendations and learning pathways tailored to your unique profile.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-logo">
                <a href="#">CareerPathAI</a>
                <p>AI-Enhanced Career Guidance System</p>
            </div>
            <div class="footer-links">
                <div class="footer-column">
                    <h3>Explore</h3>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="explore.html">Explore</a></li>
                        <li><a href="test.html">Test</a></li>
                        <li><a href="pathways.html">Pathways</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Resources</h3>
                    <ul>
                        <li><a href="#">Blog</a></li>
                        <li><a href="#">Guides</a></li>
                        <li><a href="#">Research</a></li>
                        <li><a href="#">Webinars</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Company</h3>
                    <ul>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Contact</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms of Service</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2023 CareerPathAI. All rights reserved.</p>
        </div>
    </footer>

    <script src="script.js"></script>
</body>
</html>
 

    <script>
        class TestManager {
            constructor() {
                this.currentTest = 'aptitude'; // Default to aptitude test
                this.currentSession = null;
                this.currentQuestion = 0;
                this.questions = [];
                this.answers = [];
                this.timeRemaining = 0;
                this.timerInterval = null;
                this.apiBaseUrl = 'http://localhost:3000/api/test';
                
                this.initializeEventListeners();
                
                // Show test selection by default
                this.showTestSelection();
            }

            initializeEventListeners() {
                // Test selection buttons
                const selectTestButtons = document.querySelectorAll('.select-test-btn');
                selectTestButtons.forEach(button => {
                    button.addEventListener('click', (e) => {
                        const testCard = e.target.closest('.test-card');
                        if (testCard) {
                            this.currentTest = testCard.dataset.testType;
                            this.showTestConfig();
                        }
                    });
                });
                
                // Configuration buttons
                document.getElementById('startTestBtn').addEventListener('click', () => this.startTest());
                document.getElementById('backToSelectionBtn').addEventListener('click', () => this.showTestSelection());

                // Test navigation
                document.getElementById('nextBtn').addEventListener('click', () => this.nextQuestion());
                document.getElementById('previousBtn').addEventListener('click', () => this.previousQuestion());
                document.getElementById('submitTestBtn').addEventListener('click', () => this.submitTest());

                // Results buttons
                document.getElementById('retakeTestBtn').addEventListener('click', () => this.retakeTest());
                document.getElementById('backToHomeBtn').addEventListener('click', () => window.location.href = 'index.html');
            }

            // Show test selection
            showTestSelection() {
                document.getElementById('testSelection').style.display = 'block';
                document.getElementById('testConfig').classList.remove('active');
            }
            
            // Show test configuration
            showTestConfig() {
                document.getElementById('testSelection').style.display = 'none';
                document.getElementById('testConfig').classList.add('active');
                
                // Show the appropriate test configuration based on the selected test type
                if (this.currentTest === 'aptitude') {
                    document.getElementById('testTypeDisplay').textContent = 'Cognitive Aptitude Test';
                } else if (this.currentTest === 'technical') {
                    document.getElementById('testTypeDisplay').textContent = 'Technical Skills Assessment';
                    // Show domain selection for technical test
                    document.getElementById('domainGroup').style.display = 'block';
                } else if (this.currentTest === 'softSkills') {
                    document.getElementById('testTypeDisplay').textContent = 'Professional Skills Evaluation';
                    // Hide domain selection for soft skills test
                    document.getElementById('domainGroup').style.display = 'none';
                }
            }

            // Show login modal with specific tab active
            showLoginModal(activeTab = 'login') {
                // Show the modal
                document.getElementById('auth-modal').style.display = 'flex';
                
                // Clear any previous login errors
                document.getElementById('login-form').reset();
                document.getElementById('signup-form').reset();
                
                // Activate the specified tab
                if (activeTab === 'login') {
                    document.getElementById('login-tab').click();
                } else if (activeTab === 'signup') {
                    document.getElementById('signup-tab').click();
                }
            }
            
            // Check if user is authenticated - modified to always return true (no login required)
            async checkAuthentication() {
                // Always return true since login is not required
                return true;
            }
            
            async startTest() {
                try {
                    // No authentication check needed
                    
                    this.showLoading(true, 'Preparing your assessment...');
                    
                    const config = {
                        testType: this.currentTest,
                        level: document.getElementById('testLevel').value,
                        questionCount: parseInt(document.getElementById('questionCount').value),
                        timeLimit: parseInt(document.getElementById('timeLimit').value),
                        userId: 'anonymous' // Always use anonymous user
                    };

                    if (this.currentTest === 'technical') {
                        config.domain = document.getElementById('testDomain').value;
                    }

                    // Initialize test session with the backend API
                    const apiBaseUrl = 'http://localhost:3000'; // Update with your backend URL
                    this.apiBaseUrl = apiBaseUrl;
                    
                    const response = await fetch(`${apiBaseUrl}/api/test/initialize`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                            // No authorization header needed
                        },
                        body: JSON.stringify(config)
                    });

                    if (!response.ok) {
                        // No need to handle unauthorized access specifically
                        this.showError('Failed to initialize test. Please try again.');
                        return;
                        const errorData = await response.json();
                        throw new Error(errorData.message || 'Failed to initialize test');
                    }

                    const data = await response.json();
                    
                    if (!data.success) {
                        throw new Error(data.message || 'Failed to initialize test');
                    }
                    
                    this.currentSession = data.data.sessionId;
                    this.timeRemaining = config.timeLimit * 60; // Convert to seconds
                    this.currentQuestionData = data.data.firstQuestion;
                    
                    // Start the test interface
                    this.startTestInterface();
                    
                } catch (error) {
                    console.error('Start test error:', error);
                    // Show error in UI instead of alert
                    this.showError(error.message);
                    // Use fallback test if needed
                    this.startFallbackTest();
                } finally {
                    this.showLoading(false);
                }
            }

            startFallbackTest() {
                this.currentSession = 'fallback_' + Date.now();
                this.timeRemaining = parseInt(document.getElementById('timeLimit').value) * 60;
                this.startTestInterface();
            }

            startTestInterface() {
                document.getElementById('testConfig').classList.remove('active');
                document.getElementById('testInterface').classList.add('active');
                
                // Update display
                document.getElementById('testTypeDisplay').textContent = this.getTestTypeDisplay();
                
                // Start timer
                this.startTimer();
                
                // Load first question
                this.loadQuestion();
            }

            getTestTypeDisplay() {
                const types = {
                    'aptitude': 'Cognitive Aptitude Test',
                    'technical': 'Technical Skills Assessment',
                    'softSkills': 'Professional Skills Evaluation'
                };
                return types[this.currentTest] || 'Test';
            }

            startTimer() {
                this.updateTimerDisplay();
                this.timerInterval = setInterval(() => {
                    this.timeRemaining--;
                    this.updateTimerDisplay();
                    
                    if (this.timeRemaining <= 0) {
                        this.submitTest();
                    }
                }, 1000);
            }

            updateTimerDisplay() {
                const minutes = Math.floor(this.timeRemaining / 60);
                const seconds = this.timeRemaining % 60;
                document.getElementById('timer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            async loadQuestion() {
                try {
                    if (this.currentSession.startsWith('fallback_')) {
                        this.displayFallbackQuestion();
                        return;
                    }
                    
                    this.showLoading(true, 'Loading question...');

                    const response = await fetch(`${this.apiBaseUrl}/api/test/question/${this.currentSession}`);
                    
                    if (!response.ok) {
                        throw new Error('Failed to load question');
                    }

                    const data = await response.json();
                    
                    if (data.data.completed) {
                        this.submitTest();
                        return;
                    }

                    // Store question data
                    this.questions[this.currentQuestion] = data.data.question;
                    
                    // Display question
                    this.displayQuestion();
                    
                    // Update progress
                    this.updateProgress();
                    
                    // Hide loading indicator
                    this.showLoading(false);
                    
                } catch (error) {
                    console.error('Load question error:', error);
                    this.showError('Failed to load question. Using fallback question instead.');
                    this.displayFallbackQuestion();
                    this.showLoading(false);
                }
            }

            displayQuestion() {
                const question = this.questions[this.currentQuestion];
                
                document.getElementById('questionText').textContent = question.question;
                
                const optionsContainer = document.getElementById('optionsContainer');
                optionsContainer.innerHTML = '';
                
                question.options.forEach((option, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'option';
                    optionDiv.innerHTML = `
                        <span class="option-label">${String.fromCharCode(65 + index)}</span>
                        <span>${option}</span>
                    `;
                    
                    // Check if this option was previously selected
                    if (this.answers[this.currentQuestion] === index) {
                        optionDiv.classList.add('selected');
                    }
                    
                    optionDiv.addEventListener('click', () => this.selectOption(index));
                    optionsContainer.appendChild(optionDiv);
                });
                
                // Update navigation buttons
                this.updateNavigationButtons();
            }

            displayFallbackQuestion() {
                // Show loading state while waiting for Gemini to generate questions
                document.getElementById('questionText').textContent = 'Generating AI-powered question...';
                document.getElementById('optionsContainer').innerHTML = '<div style="text-align: center; padding: 2rem;"><div class="spinner"></div><p>AI is creating your personalized question...</p></div>';
                
                // Simulate API call delay
                setTimeout(() => {
                    // Create a placeholder question structure for Gemini integration
                    const placeholderQuestion = {
                        question: 'AI-generated question will appear here...',
                        options: ['Option A', 'Option B', 'Option C', 'Option D'],
                        correctAnswer: 0
                    };
                    
                    this.questions[this.currentQuestion] = placeholderQuestion;
                    this.displayQuestion();
                }, 2000);
            }

            selectOption(optionIndex) {
                // Remove previous selection
                document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
                
                // Select current option
                event.target.closest('.option').classList.add('selected');
                
                // Store answer
                this.answers[this.currentQuestion] = optionIndex;
            }

            updateProgress() {
                const totalQuestions = parseInt(document.getElementById('questionCount').value);
                const progress = ((this.currentQuestion + 1) / totalQuestions) * 100;
                
                document.getElementById('progressFill').style.width = `${progress}%`;
                document.getElementById('questionProgress').textContent = 
                    `Question ${this.currentQuestion + 1} of ${totalQuestions}`;
            }

            updateNavigationButtons() {
                const totalQuestions = parseInt(document.getElementById('questionCount').value);
                
                document.getElementById('previousBtn').disabled = this.currentQuestion === 0;
                document.getElementById('nextBtn').style.display = 
                    this.currentQuestion === totalQuestions - 1 ? 'none' : 'inline-block';
                document.getElementById('submitTestBtn').style.display = 
                    this.currentQuestion === totalQuestions - 1 ? 'inline-block' : 'none';
            }

            nextQuestion() {
                if (this.currentQuestion < parseInt(document.getElementById('questionCount').value) - 1) {
                    this.currentQuestion++;
                    this.loadQuestion();
                }
            }

            previousQuestion() {
                if (this.currentQuestion > 0) {
                    this.currentQuestion--;
                    this.displayQuestion();
                    this.updateProgress();
                }
            }

            async submitTest() {
                try {
                    this.showLoading(true, 'Submitting your answers...');
                    
                    // Clear timer
                    if (this.timerInterval) {
                        clearInterval(this.timerInterval);
                    }
                    
                    // Submit all answers
                    if (!this.currentSession.startsWith('fallback_')) {
                        for (let i = 0; i < this.answers.length; i++) {
                            if (this.answers[i] !== undefined) {
                                await fetch(`${this.apiBaseUrl}/api/test/answer`, {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                        // No authorization header needed
                                    },
                                    body: JSON.stringify({
                                        sessionId: this.currentSession,
                                        answer: this.answers[i],
                                        questionNumber: i + 1
                                    })
                                });
                            }
                        }
                        
                        // Get results
                        this.showLoading(true, 'AI is analyzing your results...');
                        const response = await fetch(`${this.apiBaseUrl}/api/test/results/${this.currentSession}`, {
                            headers: {
                                'Content-Type': 'application/json'
                                // No authorization header needed
                            }
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            this.displayResults(data.data);
                            return;
                        }
                    }
                    
                    // Show fallback results
                    this.displayFallbackResults();
                    
                } catch (error) {
                    console.error('Submit test error:', error);
                    this.displayFallbackResults();
                } finally {
                    this.showLoading(false);
                }
            }

            displayResults(results) {
                document.getElementById('testInterface').classList.remove('active');
                document.getElementById('resultsContainer').classList.add('active');
                
                // Display score
                document.getElementById('scoreDisplay').textContent = `${results.results.score}%`;
                
                // Display strengths
                const strengthsHtml = results.results.strengths.map(strength => 
                    `<div style="padding: 0.75rem 0; border-bottom: 1px solid #eee;"> ${strength}</div>`
                ).join('');
                document.getElementById('strengthsList').innerHTML = strengthsHtml;
                
                // Display weaknesses
                const weaknessesHtml = results.results.weaknesses.map(weakness => 
                    `<div style="padding: 0.75rem 0; border-bottom: 1px solid #eee;"> ${weakness}</div>`
                ).join('');
                document.getElementById('weaknessesList').innerHTML = weaknessesHtml;
                
                // Display recommendations
                const recommendationsHtml = results.results.recommendations.map(rec => 
                    `<div style="padding: 0.75rem 0; border-bottom: 1px solid #eee;"> ${rec}</div>`
                ).join('');
                document.getElementById('recommendationsList').innerHTML = recommendationsHtml;
                
                // Display career paths
                if (results.results.careerRecommendations) {
                    const careerHtml = results.results.careerRecommendations.careerPaths.map(path => 
                        `<div style="padding: 0.75rem 0; border-bottom: 1px solid #eee;"> ${path}</div>`
                    ).join('');
                    document.getElementById('careerPathsList').innerHTML = careerHtml;
                }
            }

            displayFallbackResults() {
                document.getElementById('testInterface').classList.remove('active');
                document.getElementById('resultsContainer').classList.add('active');
                
                // Calculate fallback score
                const totalQuestions = parseInt(document.getElementById('questionCount').value);
                const answeredQuestions = this.answers.filter(a => a !== undefined).length;
                const score = Math.round((answeredQuestions / totalQuestions) * 100);
                
                document.getElementById('scoreDisplay').textContent = `${score}%`;
                
                // Fallback content
                document.getElementById('strengthsList').innerHTML = '<div style="padding: 0.75rem 0; border-bottom: 1px solid #eee;"> Completed the assessment successfully</div>';
                document.getElementById('weaknessesList').innerHTML = '<div style="padding: 0.75rem 0; border-bottom: 1px solid #eee;"> Detailed analysis requires full AI integration</div>';
                document.getElementById('recommendationsList').innerHTML = '<div style="padding: 0.75rem 0; border-bottom: 1px solid #eee;"> Try taking the test again for complete AI analysis</div>';
                document.getElementById('careerPathsList').innerHTML = '<div style="padding: 0.75rem 0; border-bottom: 1px solid #eee;"> Complete career recommendations will be available with full AI analysis</div>';
            }

            retakeTest() {
                // Reload the page to restart the test
                window.location.reload();
            }
            
            async loadTestHistory() {
                try {
                    // No authentication check needed
                    
                    this.showLoading(true, 'Loading your test history...');
                    
                    // Use anonymous user ID or session storage for history
                    const userId = 'anonymous';
                    const response = await fetch(`${this.apiBaseUrl}/api/test/history/${userId}`, {
                        headers: {
                            'Content-Type': 'application/json'
                            // No authorization header needed
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to load test history');
                    }
                    
                    const data = await response.json();
                    this.displayTestHistory(data.data);
                    
                } catch (error) {
                    console.error('Load test history error:', error);
                    // Show error message to user
                    this.showError('Unable to load your test history. Please try again later.');
                } finally {
                    this.showLoading(false);
                }
            }
            
            displayTestHistory(history) {
                const historyContainer = document.getElementById('testHistoryContainer');
                historyContainer.classList.add('active');
                document.getElementById('testConfig').classList.remove('active');
                
                const historyList = document.getElementById('testHistoryList');
                historyList.innerHTML = '';
                
                if (!history || history.length === 0) {
                    historyList.innerHTML = '<div class="empty-history">You haven\'t taken any tests yet.</div>';
                    return;
                }
                
                history.forEach(test => {
                    const testDate = new Date(test.completedAt).toLocaleDateString();
                    const testTime = new Date(test.completedAt).toLocaleTimeString();
                    
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    historyItem.innerHTML = `
                        <div class="history-header">
                            <h3>${this.getTestTypeDisplay(test.testType)}</h3>
                            <span class="history-score">${test.score}%</span>
                        </div>
                        <div class="history-details">
                            <div><strong>Date:</strong> ${testDate} at ${testTime}</div>
                            <div><strong>Level:</strong> ${test.level}</div>
                            <div><strong>Time Taken:</strong> ${Math.floor(test.timeTaken / 60)} minutes</div>
                            ${test.domain ? `<div><strong>Domain:</strong> ${test.domain}</div>` : ''}
                        </div>
                        <button class="btn btn-primary view-results-btn" data-session="${test.sessionId}">View Results</button>
                    `;
                    
                    historyList.appendChild(historyItem);
                    
                    // Add event listener to view results button
                    const viewResultsBtn = historyItem.querySelector('.view-results-btn');
                    viewResultsBtn.addEventListener('click', () => this.viewTestResults(test.sessionId));
                });
            }
            
            async viewTestResults(sessionId) {
                try {
                    this.showLoading(true, 'Loading test results...');
                    
                    const response = await fetch(`${this.apiBaseUrl}/api/test/results/${sessionId}`, {
                        headers: {
                            'Content-Type': 'application/json'
                            // No authorization header needed
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to load test results');
                    }
                    
                    const data = await response.json();
                    this.displayResults(data.data);
                    
                    // Hide history container
                    document.getElementById('testHistoryContainer').classList.remove('active');
                    
                } catch (error) {
                    console.error('View test results error:', error);
                    this.showError('Unable to load test results. Please try again later.');
                } finally {
                    this.showLoading(false);
                }
            }
            
            showError(message) {
                const errorContainer = document.getElementById('errorContainer');
                const errorMessage = document.getElementById('errorMessage');
                
                errorMessage.textContent = message;
                errorContainer.style.display = 'flex';
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    errorContainer.style.display = 'none';
                }, 5000);
            }

            showLoading(show, message = 'AI is analyzing your profile...') {
            const loadingElement = document.getElementById('loading');
            const loadingText = document.getElementById('loading-text');
            
            if (loadingText) {
                loadingText.textContent = message;
            }
            
            loadingElement.classList.toggle('active', show);
        }
        }

        // Initialize test manager when page loads
        document.addEventListener('DOMContentLoaded', async () => {
            const testManager = new TestManager();
            
            // No token validation needed
            
            // Update UI to show that login is optional
            document.getElementById('login-button').textContent = 'Login';
            document.getElementById('signup-button').textContent = 'Signup';
            
            // Add event listener for view history button
            document.getElementById('viewHistoryBtn').addEventListener('click', function() {
                testManager.loadTestHistory();
            });
            
            // Add event listener for back to tests button in history view
            document.getElementById('backToTestsBtn').addEventListener('click', function() {
                document.getElementById('testHistoryContainer').classList.remove('active');
                document.getElementById('testSelection').style.display = 'block';
            });
            
            // Handle login form submission
            document.getElementById('login-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                
                try {
                    const apiBaseUrl = 'http://localhost:3000';
                    const response = await fetch(`${apiBaseUrl}/api/auth/login`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ email, password })
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        // Store token and user info
                        localStorage.setItem('token', data.token);
                        localStorage.setItem('userId', data.user.id);
                        localStorage.setItem('userName', data.user.name);
                        
                        // Update UI
                        document.getElementById('auth-modal').style.display = 'none';
                        document.getElementById('login-button').style.display = 'none';
                        document.getElementById('signup-button').style.display = 'none';
                        document.getElementById('user-profile').style.display = 'block';
                        
                        // Reset form
                        document.getElementById('login-form').reset();
                    } else {
                        testManager.showError(data.message || 'Login failed. Please check your email and password.');
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    testManager.showError('Login failed. Please check your connection and try again.');
                }
            });
            
            // Handle signup form submission
            document.getElementById('signup-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const name = document.getElementById('signup-name').value;
                const email = document.getElementById('signup-email').value;
                const password = document.getElementById('signup-password').value;
                const confirmPassword = document.getElementById('signup-confirm').value;
                
                if (password !== confirmPassword) {
                    testManager.showError('Passwords do not match. Please try again.');
                    return;
                }
                
                try {
                    const apiBaseUrl = 'http://localhost:3000';
                    const response = await fetch(`${apiBaseUrl}/api/auth/register`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ name, email, password })
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        // Store token and user info
                        localStorage.setItem('token', data.token);
                        localStorage.setItem('userId', data.user.id);
                        localStorage.setItem('userName', data.user.name);
                        
                        // Update UI
                        document.getElementById('auth-modal').style.display = 'none';
                        document.getElementById('login-button').style.display = 'none';
                        document.getElementById('signup-button').style.display = 'none';
                        document.getElementById('user-profile').style.display = 'block';
                        
                        // Reset form
                        document.getElementById('signup-form').reset();
                    } else {
                        testManager.showError(data.message || 'Registration failed. Please try with a different email.');
                    }
                } catch (error) {
                    console.error('Signup error:', error);
                    testManager.showError('Registration failed. Please check your connection and try again.');
                }
            });
            
            // Handle login/signup button clicks
            document.getElementById('login-button').addEventListener('click', () => {
                testManager.showLoginModal('login');
            });
            
            document.getElementById('signup-button').addEventListener('click', () => {
                testManager.showLoginModal('signup');
            });
            
            // Handle tab switching
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs and forms
                    document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
                    
                    // Add active class to clicked tab and corresponding form
                    tab.classList.add('active');
                    const target = tab.getAttribute('data-target');
                    document.querySelector(target).classList.add('active');
                });
            });
            
            // Handle close modal button
            document.getElementById('close-auth-modal').addEventListener('click', () => {
                document.getElementById('auth-modal').style.display = 'none';
            });
            
            // Add logout functionality
            const userProfile = document.getElementById('user-profile');
            userProfile.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Create dropdown menu
                const dropdown = document.createElement('div');
                dropdown.className = 'profile-dropdown';
                dropdown.innerHTML = `
                    <div class="dropdown-item">
                        <i class="fas fa-user"></i> Profile
                    </div>
                    <div class="dropdown-item" id="logout-btn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </div>
                `;
                
                // Position dropdown
                const rect = userProfile.getBoundingClientRect();
                dropdown.style.position = 'absolute';
                dropdown.style.top = rect.bottom + 'px';
                dropdown.style.right = (window.innerWidth - rect.right) + 'px';
                dropdown.style.backgroundColor = '#fff';
                dropdown.style.boxShadow = '0 2px 10px rgba(0,0,0,0.1)';
                dropdown.style.borderRadius = '4px';
                dropdown.style.padding = '8px 0';
                dropdown.style.zIndex = '1000';
                
                // Style dropdown items
                const dropdownItems = dropdown.querySelectorAll('.dropdown-item');
                dropdownItems.forEach(item => {
                    item.style.padding = '8px 16px';
                    item.style.cursor = 'pointer';
                    item.style.transition = 'background-color 0.2s';
                    
                    item.addEventListener('mouseover', () => {
                        item.style.backgroundColor = '#f5f5f5';
                    });
                    
                    item.addEventListener('mouseout', () => {
                        item.style.backgroundColor = 'transparent';
                    });
                });
                
                // Add to body
                document.body.appendChild(dropdown);
                
                // Handle logout
                document.getElementById('logout-btn').addEventListener('click', () => {
                    // Clear local storage
                    localStorage.removeItem('token');
                    localStorage.removeItem('userId');
                    localStorage.removeItem('userName');
                    
                    // Update UI
                    document.getElementById('login-button').style.display = 'inline-block';
                    document.getElementById('signup-button').style.display = 'inline-block';
                    document.getElementById('user-profile').style.display = 'none';
                    
                    // Remove dropdown
                    document.body.removeChild(dropdown);
                });
                
                // Close dropdown when clicking outside
                const closeDropdown = (e) => {
                    if (!dropdown.contains(e.target) && e.target !== userProfile) {
                        document.body.removeChild(dropdown);
                        document.removeEventListener('click', closeDropdown);
                    }
                };
                
                // Add delay to prevent immediate closing
                setTimeout(() => {
                    document.addEventListener('click', closeDropdown);
                }, 100);
            });
            
            // Check if user is already logged in (optional)
            const token = localStorage.getItem('token');
            const userId = localStorage.getItem('userId');
            
            if (token && userId) {
                document.getElementById('login-button').style.display = 'none';
                document.getElementById('signup-button').style.display = 'none';
                document.getElementById('user-profile').style.display = 'block';
            } else {
                document.getElementById('login-button').style.display = 'inline-block';
                document.getElementById('signup-button').style.display = 'inline-block';
                document.getElementById('user-profile').style.display = 'none';
            }
            
            // Note: Login is optional for taking tests
        });
    </script>
</body>
</html>

